<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12">
      @if (tasks.length === 0) {
        <!-- Empty State -->
        <div class="text-center py-5">
          <div class="empty-state">
            <i class="bi bi-clipboard-x display-1 text-muted mb-3"></i>
            <h3 class="text-muted">No tasks found</h3>
            <p class="text-muted">Add a new task above to get started!</p>
          </div>
        </div>
      } @else {
        <!-- Tasks Grid -->
        <div class="row g-3">
          @for (task of tasks; track task.id) {
            <div class="col-lg-6 col-xl-4">
              <div class="card task-card h-100" 
                   [class]="getPriorityClass(task.priority)"
                   [class.completed-task]="task.completed"
                   [class.overdue-task]="isOverdue(task)"
                   [class.due-soon-task]="isDueSoon(task)">
                
                <!-- Task Header -->
                <div class="card-header d-flex justify-content-between align-items-start p-3">
                  <div class="d-flex align-items-center flex-grow-1">
                    <!-- Completion Checkbox -->
                    <div class="form-check me-2">
                      <input 
                        class="form-check-input" 
                        type="checkbox" 
                        [checked]="task.completed"
                        (change)="toggleComplete(task)"
                        [id]="'task-' + task.id"
                      >
                    </div>
                    
                    <!-- Priority Badge -->
                    <span class="badge rounded-pill me-2" [class]="getPriorityBadgeClass(task.priority)">
                      @switch (task.priority) {
                        @case ('high') { <i class="bi bi-exclamation-triangle"></i> HIGH }
                        @case ('medium') { <i class="bi bi-dash-circle"></i> MED }
                        @case ('low') { <i class="bi bi-arrow-down-circle"></i> LOW }
                      }
                    </span>
                    
                    <!-- Category Badge -->
                    <span class="badge rounded-pill" [class]="getCategoryBadgeClass(task.category)">
                      <i class="bi bi-tag"></i> {{ task.category }}
                    </span>
                  </div>
                  
                  <!-- Task Actions -->
                  @if (editingId !== task.id) {
                    <div class="dropdown">
                      <button class="btn btn-link btn-sm text-muted p-0" 
                              type="button" 
                              [id]="'dropdownMenuButton-' + task.id"
                              data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots-vertical"></i>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                          <a class="dropdown-item" href="#" (click)="startEditing(task); $event.preventDefault()">
                            <i class="bi bi-pencil"></i> Edit
                          </a>
                        </li>
                        <li>
                          <a class="dropdown-item" href="#" (click)="toggleComplete(task); $event.preventDefault()">
                            <i class="bi" [class.bi-check2]="!task.completed" [class.bi-arrow-counterclockwise]="task.completed"></i>
                            {{ task.completed ? 'Mark Incomplete' : 'Mark Complete' }}
                          </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                          <a class="dropdown-item text-danger" href="#" (click)="deleteTaskHandler(task.id); $event.preventDefault()">
                            <i class="bi bi-trash"></i> Delete
                          </a>
                        </li>
                      </ul>
                    </div>
                  }
                </div>
                
                <!-- Task Body -->
                <div class="card-body p-3">
                  @if (editingId !== task.id) {
                    <!-- Display Mode -->
                    <div>
                      <p class="card-text mb-2" [class.text-decoration-line-through]="task.completed">
                        {{ task.text }}
                      </p>
                      
                      <!-- Due Date -->
                      @if (task.dueDate) {
                        <div class="mb-2">
                          <small class="text-muted">
                            <i class="bi bi-calendar-event"></i>
                            Due: {{ formatDate(task.dueDate) }}
                            @if (isOverdue(task)) {
                              <span class="text-danger ms-1">(Overdue)</span>
                            } @else if (isDueSoon(task)) {
                              <span class="text-warning ms-1">(Due Soon)</span>
                            }
                          </small>
                        </div>
                      }
                      
                      <!-- Timestamps -->
                      <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                          <i class="bi bi-clock"></i>
                          Created {{ getTimeSince(task.createdAt) }}
                        </small>
                        
                        @if (task.completedAt) {
                          <small class="text-success">
                            <i class="bi bi-check-circle"></i>
                            Done {{ getTimeSince(task.completedAt) }}
                          </small>
                        }
                      </div>
                    </div>
                  } @else {
                    <!-- Edit Mode -->
                    <div>
                      <!-- Text Input -->
                      <div class="mb-3">
                        <label class="form-label small">Task Description</label>
                        <textarea 
                          class="form-control form-control-sm" 
                          rows="2"
                          [(ngModel)]="editedText"
                          maxlength="200"
                          placeholder="Task description..."
                        ></textarea>
                        <div class="form-text">{{ editedText.length }}/200 characters</div>
                      </div>
                      
                      <!-- Priority and Category -->
                      <div class="row mb-3">
                        <div class="col-6">
                          <label class="form-label small">Priority</label>
                          <select class="form-select form-select-sm" [(ngModel)]="editedPriority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                          </select>
                        </div>
                        <div class="col-6">
                          <label class="form-label small">Category</label>
                          <select class="form-select form-select-sm" [(ngModel)]="editedCategory">
                            @for (category of categories; track category) {
                              <option [value]="category">{{ category }}</option>
                            }
                          </select>
                        </div>
                      </div>
                      
                      <!-- Due Date -->
                      <div class="mb-3">
                        <label class="form-label small">Due Date</label>
                        <input 
                          type="date" 
                          class="form-control form-control-sm"
                          [(ngModel)]="editedDueDate"
                          [min]="minDate"
                        >
                      </div>
                      
                      <!-- Edit Actions -->
                      <div class="d-flex justify-content-end gap-2">
                        <button class="btn btn-success btn-sm" (click)="saveEdit(task.id)">
                          <i class="bi bi-check"></i> Save
                        </button>
                        <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">
                          <i class="bi bi-x"></i> Cancel
                        </button>
                      </div>
                    </div>
                  }
                </div>
              </div>
            </div>
          }
        </div>
        
        <!-- Tasks Summary -->
        <div class="row mt-4">
          <div class="col-12">
            <div class="text-center">
              <small class="text-muted">
                Showing {{ tasks.length }} 
                {{ tasks.length === 1 ? 'task' : 'tasks' }}
              </small>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</div>